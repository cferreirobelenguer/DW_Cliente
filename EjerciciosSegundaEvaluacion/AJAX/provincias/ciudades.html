<!-- Generar una vista de un archivo json en un html mediante ajax,
cuando se seleccione una comunidad, se muestra mediante un select hecho por DOM la provincia
obtenida mediante ajax de un json-->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Búsqueda de provincias</title>
<script type="text/javascript" src="https://gc.kis.v2.scr.kaspersky-labs.com/FD126C42-EBFA-4E12-B309-BB3FDD723AC1/main.js?attr=0O2VF6FOzrE5rz9V3mB1OnzTeaNhYoZfvJDX5Bo34Yg72b8651cl4yUjerj3_PxBC2DvwkZxvpfWkKC1p7FtmHK6uNtgUwwcZWZKq9YfG0OOwCMALVWoamaLltGHZs72BlQydI7hj4tZi1v8zobKQaCoHlkQQzJ64xuFZIdDSIlk-g2cMOaakMTeeVWd8nJwSz7wPLZISmFhZMYpHvyjP_mCR-8eq9YkZZn_umNabSOgQqrVN1u5b1pH4ZNvIwJErCfVzsW45pvqUkmqyTM5ZQ5DBtS7XeL_HX1i1_kBI0kloSMsClMJF7wBiKkFlvTfwDMPeaJ1d6Z4Wwu2NjHQruIthK1hiGeBzYOVRsGjk1-beIcmpHs_hzCR4OOKy5q8YTTO0wacUGGLUIHt_PNC3tOClwr2-TeJ22zNMgCb4ER_1ePMsZS2lHD2U48w_kaU_D8YATRgEqtu94UhwWMDolcQO4Nd3fulBbVvCdRx2Im7MBTWnn7qz358qFMQPdIMUHp3_UysiMmhS2S05A-_paKfyeYRxF67ytPWvyHYlnYkC85iY58aXQsD5vgA_ir3_50z6NBbOM_GH_xRY2z1sCn0GIB-t0Frxxd6zDmx4yu0U45y1etS43ulCFN3ElvuPwpvTe_csEuJZo0SyZAbVUT4m5DWYTcSzsOVcAtH6eLEJPGvAqIJ9XVKNiixQ1FCTjr3H6PE_Q4k_vTRsdkFgLVtq7_Fs30AEArIiGT-L_u2q7Yiji83EEuW5-mIcaLZbEG2EJoRJ3KqEm9w4ik5J0PpfyZN5ocjvNvyMOJPDzACUB_Sgdaju5Ya2JE_iW-9J7SaSuk51Y9RZBThqiYFl5Kmc0wiWaMb30IIXOEY3SmEN1D_YHlPEBuC18d9QL6x-zimpKxhthuU_9-sgaKH6KvUPysPFMwHXm3hP6jKXGRGomH-Z2prtpwKH4UqVEaD1wQq4CjwlP_1W4q6hsh493wfwyZ_qBnOJFq4xDuO_cbeiGKiPFtjw2BZjSgt9BN68FjInrM2ECIo-yg6eJm_YlUlCFbJa5zyAa1qfZZf0EqYo29ibhoSBcqv2Tv8DG3UP1eYvSz9QwnaqMKrYZcy3_p-yjzEUuoXGNfWUd8pmldKXrqWKcNLhkYmcI8-47gesyen-mC9esRaSuVPpUcnUd0pr9IriKkHCdXacGizA8TlTmHeuHgY13urdekGn-iOGrcxyx-LbaWm3Z-hh6qLlQ" nonce="3095f92378a67de35bb1927f309f5801" charset="UTF-8"></script><link rel="stylesheet" crossorigin="anonymous" href="https://gc.kis.v2.scr.kaspersky-labs.com/E3E8934C-235A-4B0E-825A-35A08381A191/abn/main.css?attr=aHR0cHM6Ly9tYWlsLWF0dGFjaG1lbnQuZ29vZ2xldXNlcmNvbnRlbnQuY29tL2F0dGFjaG1lbnQvdS8wLz91aT0yJmlrPTI3NGIwOWYxNGQmYXR0aWQ9MC4xJnBlcm1tc2dpZD1tc2ctZjoxNzI0NDkzNzk3MTQ0ODQ1NDQ5JnRoPTE3ZWVhMWY4YzQyZWRjODkmdmlldz1hdHQmZGlzcD1zYWZlJnJlYWxhdHRpZD1mX2t6aXJrd2ZkMCZzYWRkYmF0PUFOR2pkSi1zNTUyZHRXMERnMGZGczhrcDNPRHBCZ0ExZzVpU3d2Sm5zUzdKLTd5NnVicF9SWFhxblhGU0ZLWlRZUW5pQTYtUGNIX21qVTcwSFhlclZqVGFKbTBZR0U2VERfY1NoUEVpMzlkUGUzRGNKU3JlMFJQOE56allaWHRsbm0xTUpvcXJUT2R6Ym40OHF2bVUyd3NWN3pNaXFHd3BQUWxQaDk5RktkNDVaQVZqNE1iOUpYNkJGQnE3QlppSTZqdWpab1B5dTR5Qzh2ODBsaGR1TlltaUduM3Q5cUZYdVlRWU9qc2RMcmdEbHVZc1BlMTBkWW91RUdsRjhSLWdQcERhM3RvVGdMeXdMQ1ZpSGV3YXQ1ZTVPSjJYbkVxT2RZbkV1eXFsNE5yTS1LYncyc1RvbmdTUFF5aVBhVVc4UTVScE80cVlEUU1WaGU4TFY3dDR0cDhmMHU4eDRHcEJ2RHNsbmE1WlF1Y3BaTkZrUGdMbEFIS0FvTThhOWtrZV9VdHVZajl2UGFMd05Sbl9lQy1WYTM3c2Y1Xzk4MnpkdzNYN2tLMXBFT1ltOTJPNUZrRVVuMkluS2pKVThJdDB0R3ZUWE9JR2Z0aFU2MndhbXRiSFh4TXAxakdvMmJ0enMyelR1R2M3YUlqX1ZzU21QazFZZ2E4S1ZWa05xZ1Z1bVdHbzlhNGFaZzluX2tLY3RrcVVrZTJKNUxvTnpOeHlQYVNqbjVPX1pxc1NoOFZFN01lZVJaS1o5TnBzM0V4SGlWRklxQ0d6aVZta1JLWVduZTZfd3k3QVRSV0FzM0VuRFlOeXBYUGFudFJ0bkRXUjVVY21JeDRxRHFHbElhZG0xdDVxaFJDeXdqN0NaSDh6Y2hRSnFpM3pwdFVUMjdvSHA4MDhvZVVsWVVzNWFKOFRIdV9HNXJ5eFhBLVN4bFk"/></head>
<body>
    <form id="formulario">
        <label for='comunidades'>Comunidades: </label>
            <select id='comunidades' name='comunidades'>
                <option value='' selected='selected'>--Elija una comunidad--</option>
                <option>andalucia</option>
                <option>aragon</option>
                <option>asturias</option>
                <option>baleares</option>
                <option>canarias</option>
                <option>castilla la mancha</option>
                <option>castilla y leon</option>
                <option>cataluña</option>
                <option>comunidad valenciana</option>
                <option>extremadura</option>
                <option>galicia</option>
                <option>la rioja</option>
                <option>madrid</option>
            </select>
    </form>
    <p id="provincias">

    </p>
    <script>
        var provincias;
        var comunidades;
        var objetoPeticion;
        var objetoRespuesta;

        function generarAjax(event){
            if(comunidades.value!=''){
                provincias.innerHTML=""; //Se limpia la lista para que no se acumulen
                objetoPeticion=comunidades;
                comunidades.disabled=true;
                const xhr = new XMLHttpRequest();
                xhr.addEventListener('readystatechange', generar, false);
                xhr.open('GET', 'provincias.json', true);
                //La siguiente línea en la que se define el oyente de evento de cambios en el estado de transición
                //combiene secuenciarla antes del método open.
                //xhr.addEventListener('readystatechange', generar, false);
                
		        xhr.send(null);
            }else{
                provincias.value='';
            }
        }
        function generar(event){
            //Me imprime todo 2 veces y no entiendo el motivo
            //El status es 200
            console.log(event.target.readyState);
            console.log(event.target.status);
            //La siguiente línea es necesaria para que no se produzca el efecto que trasladas.
            //El martes trataré de hacer hincapié en ello.
            if (event.target.readyState==4 && event.target.status==200){
                comunidades.disabled=false;
                //ResponseText pasa la respuesta del servidor en formato texto
                objetoRespuesta = this.responseText;
                //Lo pasa a array de objetos
                let datos=JSON.parse(this.responseText);
                console.log(datos);
                //provincias.innerHTML = `${datos[comunidades.value]}`;
                let total=datos[comunidades.value];
                //Se crea select con los items de provincias en DOM
                let elemento=document.createElement('select');
                for(let item of total){
                    let opciones=document.createElement('option');
                    let texto=document.createTextNode(item);
                    opciones.setAttribute("value",item);
                    
                    elemento.appendChild(opciones);
                    opciones.appendChild(texto);

                }
                provincias.appendChild(elemento);
            }
        }
        
        

        document.addEventListener('readystatechange',inicializar,false);
        function inicializar(){
            if(document.readyState=='complete'){
                //Nos situamos en los elementos e invocamos un evento change al introducir la comunidad en select
                comunidades=document.getElementById("comunidades");
                provincias=document.getElementById("provincias");
                comunidades.addEventListener('change',generarAjax,false);
                
            }
        }
    </script>

</body>
</html>
